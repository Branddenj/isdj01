<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Iteration</title>
    <meta charset="utf-8" />
    <meta name="author" content="University of Edinburgh" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Iteration
]
.subtitle[
## <br><br> Introduction to Data Science
]
.author[
### University of Edinburgh
]
.date[
### <br> 2023/2024
]

---






class: middle

# Iterations

---
## For loops in R

- The `for` loop will iterate the expression through the number of components in `values` (list, matrix or vector) one at a time.
- It is an entry controlled loop, in this loop the **values** are tested first, then the **body of the loop is executed** in each of the values.
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
---
## For loops in R

- The `for` loop will iterate the expression through the number of components in `values` (list, matrix or vector) one at a time.
- It is an entry controlled loop, in this loop the **values** are tested first, then the **body of the loop is executed** in each of the values.

R – For loop Syntax:

```r
for (values) {
  
  #statement
  
}
```
---

#Example 1


```r
for (i in 1:10){
  
  print(5*i)

  }
```

```
## [1] 5
## [1] 10
## [1] 15
## [1] 20
## [1] 25
## [1] 30
## [1] 35
## [1] 40
## [1] 45
## [1] 50
```
---

#Example 2


```r
# Create a vector with the days of the week
week &lt;- c('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday',
           'Friday', 'Saturday')
 
# using for loop to iterate over the values in the vector
for (day in week)
{
     # displaying each string in the vector
    print(day)
}
```

```
## [1] "Sunday"
## [1] "Monday"
## [1] "Tuesday"
## [1] "Wednesday"
## [1] "Thursday"
## [1] "Friday"
## [1] "Saturday"
```
---

## While loops in R

- The `while` loop will iterate the expression as long as the component in `condition` is TRUE.
- In this loop the **test condition** is tested first, then the **body of the loop is executed**, the loop body would not be executed if the test condition is false.
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
---
## While loops in R

- The `while` loop will iterate the expression as long as the component in `condition` is TRUE.
- In this loop the **test condition** is tested first, then the **body of the loop is executed**, the loop body would not be executed if the test condition is false.

R – While loop Syntax:

```r
while (condition) {
  
  #statement
  
}
```
---

#Example 1


```r
i &lt;- 0

while (i &lt; 10){

    print(5*i)
   i &lt;- i+1  # Be careful or is an infinite loop

   }
```

```
## [1] 0
## [1] 5
## [1] 10
## [1] 15
## [1] 20
## [1] 25
## [1] 30
## [1] 35
## [1] 40
## [1] 45
```
---

#Example 2

Program to calculate factorial of a number.

.pull-left[

```r
# create variable whose 
# factorial will be calculated
n &lt;- 5
# assigning the factorial variable
# and iteration variable to 1
factorial &lt;- 1
i &lt;- 1
 
# using while loop
while (i &lt;= n)
{
 
    # multiplying the factorial variable
    # with the iteration variable
    factorial = factorial * i
 
    # add one iteration 
    i = i + 1
}
```
]
.pull-right[

```r
# displaying the factorial
print(factorial)
```

```
## [1] 120
```
]
---
See the following example to illustrate how similiar for and while loops are:
.pull-left[

```r
values &lt;- 1

while(values &lt;= 10) {
        print(values)
        values &lt;- values + 1
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
```
]
.pull-right[

```r
# this for loop provides the same output
values &lt;- 10

for(i in 1:values) {
        print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10
```
]

---
# Main differences between for and while loop.

- For loop is used when the number of iterations a code should be run is **known** where a while loop is used when the number of iterations is **not known**.

- `while` loops can potentially result in infinite loops if not written properly.

- In `for` loop the initialization once done is never repeated.

- In `while` loop the initialization is done each time the loop iterate.

---

## Repeat loops in R

- The `repeat` loop will run the same `statement` until the `stop condition` has been encountered. 
- If no stop condition is present in the body of the repeat loop then it will iterate infinitely.

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
---
## Repeat loops in R

- The `repeat` loop will run the same `statement` until the `stop condition` has been encountered. 
- If no stop condition is present in the body of the repeat loop then it will iterate infinitely.

R – Repeat loop Syntax:

```r
repeat 
{ 
   statement
 
   if( stop condition ) 
   {
      break
   }
}
```
---

#Example 1


```r
i &lt;- 1

repeat
{
    # statements
    print(i)
    i &lt;- i+ 1
 
    # Stop condition
    if(i &gt; 5)
    {
        # using break statement
        # to terminate the loop
        break
    }
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
```
---

#Example 2


```r
# initializing the iteration variable with 0
i &lt;- 0
repeat
{
    # statement to be executed multiple times
    print("Hello world")
 
    # incrementing the iteration variable
    i &lt;- i + 1
 
    # checking the stop condition
    if (i == 5)
    {
        # terminate the loop
        break
    }
}
```

```
## [1] "Hello world"
## [1] "Hello world"
## [1] "Hello world"
## [1] "Hello world"
## [1] "Hello world"
```
---
**Avoid** to create an infinite loop by mistake.

- Be careful with the condition being `TRUE` and `FALSE`.

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

---

**Avoid** to create an infinite loop by mistake.

- Be careful with the condition being `TRUE` and `FALSE`.

Examples

.pull-left[

```r
#EXAMPLE 1
2/7 + 3/7 + 2/7
```

```
## [1] 1
```

```r
2/7 + 3/7 + 2/7 == 1
```

```
## [1] FALSE
```

```r
2/7 + 3/7 + 2/7 - 1
```

```
## [1] -1.110223e-16
```
]
.pull-right[

```r
#EXAMPLE 2
1 + 10^(-16) == 1
```

```
## [1] TRUE
```

```r
10^(-16) 
```

```
## [1] 1e-16
```

```r
.Machine$double.eps
```

```
## [1] 2.220446e-16
```
]
---

Instead use a **tolerance** value.



```r
#EXAMPLE 1
2/7 + 3/7 + 2/7 == 1
```

```
## [1] FALSE
```

```r
tolerance &lt;- 10^-16  #Something you consider small. 

2/7 + 3/7 + 2/7 - 1 &lt; tolerance
```

```
## [1] TRUE
```

```r
tolerance &lt;- .Machine$double.eps #The machine epsilon

2/7 + 3/7 + 2/7 - 1 &lt; tolerance
```

```
## [1] TRUE
```
---

- R like other numerical software in existence, uses **floating point arithmetic** to do its calculations.

- Represents real numbers approximately, using an integer with a fixed precision, scaled by an integer exponent of a fixed base. 

- For example, `\(12.345\)` can be represented as a base-ten floating-point number:
`$$12345\times10^{-3}$$`
- Be careful and instead use the **tolerance** value inside the `conditions`.

---

##Example


```r
j &lt;- 0
while (j &lt; 1) { j &lt;- j+0.1 }; j
```

```
## [1] 1.1
```

```r
j &lt;- 0
j + .1 + .1 + .1 + .1 + .1 + .1 + .1 + .1 + .1 + .1
```

```
## [1] 1
```

```r
j + .1 + .1 + .1 + .1 + .1 + .1 + .1 + .1 + .1 + .1 &lt; 1
```

```
## [1] TRUE
```

```r
j &lt;- 0
tolerance &lt;- 10^-16 
while (j  &lt; 1 - tolerance) { j &lt;- j+0.1 }; j
```

```
## [1] 1
```

---
## Avoiding Explicit Loops 

Suppose we have exam 1 and exam 2 scores of 10 students stored in a list...


```r
exam_scores &lt;- list(
  exam1 &lt;- c(80, 90, 70, 50, 80, 40, 90, 95, 80, 90),
  exam2 &lt;- c(85, 83, 45, 60, 85, 95, 40, 75, 90, 85)
)
```

Calculate the mean of exam 1 and exam 2 using a loop:


```r
m &lt;- numeric()
for (i in 1:length(exam_scores)){
  m[i] &lt;- mean(exam_scores[[i]])
}
m
```

```
## [1] 76.5 74.3
```
---

class: middle
# We want to make R code both simpler and more efficient.

---

## How does mapping work?

Suppose we have exam 1 and exam 2 scores of 10 students stored in a list...


```r
exam_scores &lt;- list(
  exam1 &lt;- c(80, 90, 70, 50, 80, 40, 90, 95, 80, 90),
  exam2 &lt;- c(85, 83, 45, 60, 85, 95, 40, 75, 90, 85)
)
```

--

...and we find the mean score in each exam


```r
map(exam_scores, mean)
```

```
## [[1]]
## [1] 76.5
## 
## [[2]]
## [1] 74.3
```

---

...and suppose we want the results as a numeric (double) vector


```r
map_dbl(exam_scores, mean)
```

```
## [1] 76.5 74.3
```


---

## `map_something`

Functions for looping over an object and returning a value (of a specific type):

* `map()` - returns a list
* `map_lgl()` - returns a logical vector
* `map_int()` - returns a integer vector
* `map_dbl()` - returns a double vector
* `map_chr()` - returns a character vector
* `map_df()` / `map_dfr()` - returns a data frame by row binding
* `map_dfc()` - returns a data frame by column binding
* ...

---

Example of the students

```r
exam_scores &lt;- list(
  exam1 &lt;- c(80, 90, 70, 50, 80, 40, 90, 95, 80, 90),
  exam2 &lt;- c(85, 83, 45, 60, 85, 95, 40, 75, 90, 85)
)
```
---
Compare the **times** of the two approaches.
.pull-left[

```r
start.time &lt;- Sys.time()
m &lt;- numeric()
for (i in 1:length(exam_scores)){
  m[i] &lt;- mean(exam_scores[[i]])
}
m
```

```
## [1] 76.5 74.3
```

```r
end.time &lt;- Sys.time()
end.time - start.time
```

```
## Time difference of 0.00701499 secs
```
]
.pull-right[

```r
start.time &lt;- Sys.time()
map_dbl(exam_scores, mean)
```

```
## [1] 76.5 74.3
```

```r
end.time &lt;- Sys.time()
end.time - start.time
```

```
## Time difference of 0.004650831 secs
```
]
---

Example of the students with 10 exams and 100 students.

```r
num_students &lt;- 100
possible_marks &lt;- seq(from = 0, to = 100, by = 1)
exam_scores &lt;- list(
  exam1  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam2  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam3  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam4  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam5  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam6  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam7  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam8  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam9  &lt;- sample(x = possible_marks, size = num_students, replace = TRUE),
  exam10 &lt;- sample(x = possible_marks, size = num_students, replace = TRUE)
)
head(exam_scores)
```

```
## [[1]]
##  [1] 39 93  0 39 90 79 45 70 12 61
##  [ reached getOption("max.print") -- omitted 90 entries ]
## 
## [[2]]
##  [1] 17 19 38  9 91 29 26 47 33 59
##  [ reached getOption("max.print") -- omitted 90 entries ]
## 
## [[3]]
##  [1] 98 22 87  7 33 38 24 18 77 25
##  [ reached getOption("max.print") -- omitted 90 entries ]
## 
## [[4]]
##  [1] 26  0 18 68 99 32 37 18 22 54
##  [ reached getOption("max.print") -- omitted 90 entries ]
## 
## [[5]]
##  [1] 68 81 59 72 70  5  8 97 81 73
##  [ reached getOption("max.print") -- omitted 90 entries ]
## 
## [[6]]
##  [1]  8 52 74  5 30 86 19 63 31  9
##  [ reached getOption("max.print") -- omitted 90 entries ]
```
---
Compare the **times** of the two approaches.
.pull-left[

```r
start.time &lt;- Sys.time()
m &lt;- numeric()
for (i in 1:length(exam_scores)){
  m[i] &lt;- mean(exam_scores[[i]])
}
m
```

```
## [1] 44.55 49.67 50.28 48.71 48.92
##  [ reached getOption("max.print") -- omitted 5 entries ]
```

```r
end.time &lt;- Sys.time()
end.time - start.time
```

```
## Time difference of 0.006573915 secs
```
]
.pull-right[

```r
start.time &lt;- Sys.time()
map_dbl(exam_scores, mean)
```

```
## [1] 44.55 49.67 50.28 48.71 48.92
##  [ reached getOption("max.print") -- omitted 5 entries ]
```

```r
end.time &lt;- Sys.time()
end.time - start.time
```

```
## Time difference of 0.002008915 secs
```
]
---
class: middle

# Useful functions to deal with strings.
---

## `str` family of functions on package `stringr`


```r
ls("package:stringr")
```

```
##  [1] "%&gt;%"               "boundary"          "coll"             
##  [4] "fixed"             "fruit"             "invert_match"     
##  [7] "regex"             "sentences"         "str_c"            
## [10] "str_conv"          "str_count"         "str_detect"       
## [13] "str_dup"           "str_ends"          "str_equal"        
## [16] "str_escape"        "str_extract"       "str_extract_all"  
## [19] "str_flatten"       "str_flatten_comma" "str_glue"         
## [22] "str_glue_data"     "str_interp"        "str_length"       
## [25] "str_like"          "str_locate"        "str_locate_all"   
## [28] "str_match"         "str_match_all"     "str_order"        
## [31] "str_pad"           "str_rank"          "str_remove"       
## [34] "str_remove_all"    "str_replace"       "str_replace_all"  
## [37] "str_replace_na"    "str_sort"          "str_split"        
## [40] "str_split_1"       "str_split_fixed"   "str_split_i"      
## [43] "str_squish"        "str_starts"        "str_sub"          
## [46] "str_sub_all"       "str_sub&lt;-"         "str_subset"       
## [49] "str_to_lower"      "str_to_sentence"   "str_to_title"     
## [52] "str_to_upper"      "str_trim"          "str_trunc"        
## [55] "str_unique"        "str_view"          "str_view_all"     
## [58] "str_which"         "str_width"         "str_wrap"         
## [61] "word"              "words"
```

---

## Example

```r
#Create character vector
my_vector &lt;- "Hey there everyone."

#remove first occurrence of "e" from vector
str_remove(my_vector, "e")
```

```
## [1] "Hy there everyone."
```

```r
#remove all occurrences of "e" from vector
str_remove_all(my_vector, "e")
```

```
## [1] "Hy thr vryon."
```

---

## The `separate` function

## Example


```r
#create data frame
df &lt;- data.frame(player=c('A', 'A', 'B', 'B', 'C', 'C'),
                 year=c(1, 2, 1, 2, 1, 2),
                 stats=c('22-2', '29-3', '18-6', '11-8', '12-5', '19-2'))

df
```

```
##   player year stats
## 1      A    1  22-2
## 2      A    2  29-3
## 3      B    1  18-6
## 4      B    2  11-8
## 5      C    1  12-5
## 6      C    2  19-2
```
---

## The `separate` function

## Example


```r
separate(df, col=stats, into=c('points', 'assists'), sep='-')
```

```
##   player year points assists
## 1      A    1     22       2
## 2      A    2     29       3
## 3      B    1     18       6
## 4      B    2     11       8
## 5      C    1     12       5
## 6      C    2     19       2
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
